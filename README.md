# gcal-future-sync-script

## 概要

`gcal-future-sync-script` は、Google Apps Scriptで動作するスクリプトです。指定した複数のGoogleカレンダー（ソースカレンダー）から**今日以降の予定のみ**を取得し、別の指定した単一のGoogleカレンダー（デスティネーションカレンダー）へ定期的に同期します。

**主なユースケース:**

* Googleカレンダーの過去の予定はプライベートに保ちつつ、今後の予定だけを他者や別の目的（例: 共有用カレンダー、通知用カレンダー）に共有したい。
* ソースカレンダーの予定は編集させず、デスティネーションカレンダーでは閲覧のみを目的とする。
* このスクリプトは、新しい「共有用」カレンダーを作成し、そこに既存カレンダーの未来の予定を自動で同期させることで、上記のようなニーズを実現します。

**主な機能:**

* 複数のソースカレンダーに対応。
* 「今日」を基準とし、指定した日数先までの未来の予定を同期対象とします。
* ソースカレンダーの予定タイトルに特定のタグ（デフォルト: `#nocopy`）が含まれる場合、その予定は同期対象外となります。
* 同期処理には、以下の内容が含まれます：
    * **新規作成**: ソースに新しい未来の予定が追加された場合、デスティネーションに作成します。
    * **更新**: ソースの未来の予定が変更された場合（タイトル、日時、説明、場所など）、デスティネーションの対応する予定も更新します。
    * **削除**:
        * ソースから未来の予定が削除された場合。
        * ソースの予定に除外タグ (`#nocopy`) が追加された場合。
        * ソースの予定が過去のものになったり、指定の同期期間外になった場合。
* デスティネーションカレンダーの予定の説明欄に、元のソースイベントIDを記録することで、正確な紐付けと同期を実現します。

## 設定方法

1.  **Google Apps Scriptエディタを開く**:
    * Googleドライブで「新規」>「その他」>「Google Apps Script」を選択します。
    * または、既存のGoogleスプレッドシートなどから「拡張機能」>「Apps Script」を選択します。
2.  **コードのコピー**:
    * このリポジトリにある `Code.gs` （または主要な `.gs` ファイル）の内容をスクリプトエディタにコピー＆ペーストします。
3.  **設定値の構成**:
    * **方法1: スクリプト内の定数を直接編集** (スクリプト上部)
        * `DEFAULT_SOURCE_CALENDAR_IDS`: 同期元のカレンダーIDの配列。
            * 例: `['your-source-id1@group.calendar.google.com', 'your-source-id2@gmail.com']`
        * `DEFAULT_DESTINATION_CALENDAR_ID`: 同期先のカレンダーID。
        * `DEFAULT_DAYS_TO_SYNC`: 今日から何日先までの予定を同期対象とするか（数値）。
        * `DEFAULT_NO_COPY_TAG` (任意): 同期を除外する予定のタイトルに含まれるタグ。
    * **方法2: スクリプトプロパティを使用（推奨）**
        * スクリプトエディタの左側メニュー「プロジェクトの設定」（歯車アイコン）>「スクリプト プロパティ」セクションで「スクリプト プロパティを編集」をクリックします。
        * 以下のキーと値を設定します。
            * `SOURCE_CALENDAR_IDS_CSV`: 同期元のカレンダーIDをカンマ区切りで入力（例: `id1@example.com,id2@example.com`）。
            * `DESTINATION_CALENDAR_ID`: 同期先のカレンダーID。
            * `DAYS_TO_SYNC`: 同期する日数（数値）。
            * `NO_COPY_TAG_OVERRIDE` (任意): `DEFAULT_NO_COPY_TAG` の値を上書きする場合に設定します。
4.  **初回実行と承認**:
    * スクリプトエディタの上部にある関数選択ドロップダウンから `syncCalendarEvents` を選択し、実行ボタン（▶）をクリックします。
    * 初回実行時には、スクリプトがGoogleカレンダーにアクセスするための承認を求められます。画面の指示に従って承認してください。（「このアプリは Google で確認されていません」と表示された場合は、「詳細」>「（プロジェクト名）に移動（安全ではありません）」と進んでください。）
5.  **定期実行トリガーの設定**:
    * スクリプトエディタで `setupTrigger` 関数を選択し、実行ボタン（▶）をクリックします。
    * これにより、`syncCalendarEvents` 関数が毎日定刻（デフォルトでは午前2時～3時頃）に自動実行されるようになります。
    * または、スクリプトエディタの左側メニュー「トリガー」（時計アイコン）から「トリガーを追加」ボタンで手動設定も可能です。
        * 実行する関数: `syncCalendarEvents`
        * イベントのソース: `時間主導型`
        * 時間ベースのトリガーのタイプ: `日付ベースのタイマー`
        * 時刻: 任意（例: `午前 2 時～ 3 時`）

## カレンダーIDの確認方法

1.  Googleカレンダー ([https://calendar.google.com](https://calendar.google.com)) を開きます。
2.  左側の「マイカレンダー」または「他のカレンダー」セクションで、対象のカレンダーにマウスオーバーします。
3.  表示される縦の三点リーダー（オプション）をクリックし、「設定と共有」を選択します。
4.  左側のメニューから「カレンダーの統合」を選択すると、「カレンダー ID」という項目にIDが表示されています。

## 注意事項

* **権限**: スクリプトを実行するGoogleアカウントは、ソースカレンダーの読み取り権限と、デスティネーションカレンダーの編集権限（予定の作成・変更・削除）を持っている必要があります。
* **API割り当て**: Google Apps Scriptには、1日の実行時間やAPI呼び出し回数に制限があります。非常に多くの予定を頻繁に同期する場合、制限に達する可能性があります。`DAYS_TO_SYNC` を大きな値にする場合や、多数のソースカレンダーを指定する場合はご注意ください。
* **ログの確認**: スクリプトエディタの「実行数」ページで、定期実行のログを確認し、エラーが発生していないか監視することを推奨します。
* **初期設定の確認**: スクリプト内のカレンダーIDが初期値のまま (`YOUR_...`) になっていないか確認してください。
* **テスト**: 初めて使用する際は、テスト用のカレンダーで動作を確認することをお勧めします。

## ライセンス

このスクリプトは [MITライセンス](LICENSE.txt) の下で公開されています。


